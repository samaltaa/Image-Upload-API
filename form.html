<!DOCTYPE html>
<html>
    <head>
        <title>Image Submission</title>
        <style>
            #preview {
                max-width: 400px;
                max-height: 300px;
                display: none;
                margin-top: 20px;
            }
        </style>
    </head>
    <body>
        <h2>Upload Image</h2>
        <form id="upload-form" action="http://127.0.0.1:8000/upload/" method="POST" enctype="multipart/form-data">
            <label>The chosen file will be saved to server:</label>
            <input type="file" id="file" name="file" accept=".jpg, .jpeg">
            <br><br>
            <input type="submit" value="Upload">
        </form>
        <h3>Uploaded image:</h3>
        <img id="preview" alt="Uploaded image preview">
        
        <script>
            document.getElementById("upload-form").addEventListener("submit", async function(e) {
                e.preventDefault(); // stop normal form submission

                const form = e.target;
                const fileInput = document.getElementById("file");
                
                if (!fileInput.files || fileInput.files.length === 0) {
                    alert("Please select a file first");
                    return;
                }
                
                const formData = new FormData();
                formData.append("file", fileInput.files[0]);

                try {
                    const response = await fetch("http://127.0.0.1:8000/upload/", {
                        method: "POST",
                        body: formData
                    });

                    const result = await response.json();
                    
                    if (result.url) {
                        const img = document.getElementById("preview");
                        // Make sure to use the full URL with the server address
                        img.src = "http://127.0.0.1:8000" + result.url;
                        img.style.display = "block";
                        console.log("Image URL set to:", img.src);
                    } else {
                        alert("Upload successful, but no URL returned: " + JSON.stringify(result));
                    }
                } catch (error) {
                    console.error("Error during upload:", error);
                    alert("Upload failed: " + error.message);
                }
            });
        </script>
    </body>
</html>