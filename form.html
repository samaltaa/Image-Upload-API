<!DOCTYPE html>
<html>
<head>
    <title>Subject Submission</title>
    <style>
        .card {
            border: 1px solid #ccc;
            padding: 12px;
            margin-top: 10px;
            max-width: 300px;
        }

        .card img {
            max-width: 100%;
            height: auto;
        }
    </style>
</head>
<body>
    <h2>Submit New Subject</h2>
    <form id="subject-form" enctype="multipart/form-data">
        
        <label>First Name:</label><br>
        <input type="text" name="first_name" required><br><br>

        <label>Last Name:</label><br>
        <input type="text" name="last_name" required><br><br>

        <label>Date of Birth:</label><br>
        <input type="date" name="dob" required><br><br>

        <label>Upload Image:</label><br>
        <input type="file" name="image" accept="image/*" required><br><br>

        <input type="submit" value="Submit">
    </form>

    <h3>Subjects:</h3>
    <div id="subjects-container"></div>

    <script>
        const form = document.getElementById("subject-form");
        const container = document.getElementById("subjects-container");

        form.addEventListener("submit", async function (e) {
            e.preventDefault();

            const formData = new FormData(form);

            const response = await fetch("http://127.0.0.1:8000/subjects/", {
                method: "POST",
                body: formData
            });

            if (response.ok) {
                alert("Subject added!");
                form.reset();
                loadSubjects(); // refresh card list
            } else {
                const err = await response.json();
                alert("Error: " + err.detail);
            }
        });

        async function loadSubjects() {
            const res = await fetch("http://127.0.0.1:8000/subjects/");
            const data = await res.json();

            container.innerHTML = "";
            data.forEach(subject => {
                const card = document.createElement("div");
                card.className = "card";

                const img = document.createElement("img");
                if (subject.image) {
                    img.src = `data:image/jpeg;base64,${subject.image}`;
                    card.appendChild(img);
                }

                card.innerHTML += `
                    <strong>${subject.first_name} ${subject.last_name}</strong><br>
                    DOB: ${subject.dob}<br>
                    ID: ${subject.id}<br>
                `;
                
                container.appendChild(card);
            });
        }

        loadSubjects(); // Load on page load
    </script>
</body>
</html>
